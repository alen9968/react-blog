{"ast":null,"code":"import _Promise from \"@babel/runtime-corejs2/core-js/promise\";\nimport _JSON$stringify from \"@babel/runtime-corejs2/core-js/json/stringify\";\n\nvar _this = this;\n\nimport _ from 'lodash';\nimport React from 'react';\nimport I, { Map } from 'immutable';\nimport { message as Message } from 'antd';\nimport Router from 'next/router';\nimport request from '../utils/request'; //import { selfMerge, selfSet } from '../redux/modules/self'\n\nimport { viewSetIn, setFetching, getFetching, setLoggedIn, viewSet } from '../redux/modules/view';\nimport loginState from './sessions';\nexport var uploadPhotos = function uploadPhotos() {\n  return function (D, S) {\n    var data = _JSON$stringify(S().view.get('imgList').toList().toJS());\n\n    var id = S().self.get('id');\n    request.post('/photos', {\n      data: data,\n      id: id\n    }).then(function (body) {\n      if (body.ok) {\n        D(viewSetIn(['imgList'], {})); // eslint-disable-line no-use-before-define\n\n        Message.success('保存成功');\n      }\n    });\n  };\n};\nexport var signup = function signup() {\n  return function (D, S) {\n    var _S = S(),\n        view = _S.view;\n\n    return request.post('/users', {\n      data: view.get('signup')\n    }).then(function (body) {\n      var ok = body.ok,\n          message = body.message;\n\n      if (ok === false) {\n        Message.info(message);\n      } else {\n        D(loginState());\n      }\n\n      D(viewSetIn(['signupLoading'], false));\n    });\n  };\n};\nexport var setToken = function setToken(s) {\n  return function (D) {\n    return request.setToken(s).then(function () {\n      D(loginState());\n    });\n  };\n};\nexport var logout = function logout() {\n  return function (D) {\n    return _Promise.all([request[\"delete\"]('users/sign_out'), request.setAuthorization('')]).then(function () {\n      D(setLoggedIn({\n        ok: false\n      }));\n      D(selfSet(Map()));\n      Message.success('已登出');\n      Router.push('/');\n    });\n  };\n};\nexport var processSignupQuery = function processSignupQuery(query) {\n  return function (D, S) {\n    var c = query.c,\n        email = query.email;\n\n    var _S2 = S(),\n        view = _S2.view;\n\n    D(viewSet(view.update('signup', function (s1) {\n      return s1.withMutations(function (s2) {\n        s2.setIn(['settings', 'area'], 'EC');\n\n        if (!_.isEmpty(c)) {\n          s2.set('referrer_short_id', c);\n        }\n\n        if (!_.isEmpty(email)) {\n          var form = _this.props.form;\n          s2.set('email_or_mobile', email);\n          form.setFieldsValue({\n            email: email,\n            mobile: email\n          });\n        }\n      });\n    })));\n  };\n};\nexport var getUser = function getUser(shortId) {\n  return function (D) {\n    return request.get('users/name', {\n      short_id: shortId\n    }).then(function (r) {\n      var data = r.data;\n      D(viewSetIn(['signup', 'settings', 'referrer_name'], data));\n    });\n  };\n};\nexport var createAccessToken = function createAccessToken(deviceType) {\n  return function (D) {\n    return request.post('developers/create_access_token', {\n      for_device_type: deviceType\n    }).then(function (body) {\n      if (body.ok) {\n        D(viewSetIn(['tokens'], body.tokens));\n      }\n    });\n  };\n};\nexport var tokensIndex = function tokensIndex() {\n  return function (D) {\n    return request.get('developers/access_tokens').then(function (body) {\n      if (body.ok) {\n        D(viewSetIn(['tokens'], body.tokens));\n      }\n    });\n  };\n};\nexport var deleteToken = function deleteToken(accessToken) {\n  return function (D) {\n    return request.post('developers/remove_access_token', {\n      access_token: accessToken\n    }).then(function (body) {\n      if (body.ok) {\n        D(viewSetIn(['tokens'], body.tokens));\n      }\n    });\n  };\n};\nexport var isUserExist = function isUserExist(value, callback) {\n  return function () {\n    return request.post('users/exists_by_any', {\n      value: value\n    }).then(function (r) {\n      var exists = r.exists,\n          message = r.message;\n\n      if (exists) {\n        callback(message);\n      }\n    });\n  };\n};\nexport var getProjectActives = function getProjectActives(id) {\n  return function (D) {\n    // todo push 404\n    return request.get('projects/payments_list', {\n      id: id\n    }).then(function (body) {\n      var ok = body.ok,\n          payments = body.payments;\n\n      if (ok) {\n        D(viewSetIn(['project', 'actives'], payments));\n      }\n    });\n  };\n};\nexport var updateSelf = function updateSelf() {\n  return function (D, S) {\n    var _S3 = S(),\n        self = _S3.self;\n\n    request.put(\"users/profiles/\".concat(self.get('id')), self.toJS()).then(function (body) {\n      if (body.ok) {\n        D(fundingNotification()); // eslint-disable-line no-use-before-define\n\n        Message.success('保存成功');\n      }\n    });\n  };\n};\nexport var changePassword = function changePassword() {\n  return function (D, S) {\n    var _S4 = S(),\n        self = _S4.self;\n\n    var fields = ['password', 'oldPassword', 'passwordConfirmation'];\n    request.put(\"users/passwords\", {\n      data: S().self.filter(function (v, k) {\n        return fields.indexOf(k) !== -1;\n      })\n    }).then(function (body) {\n      var ok = body.ok,\n          message = body.message;\n\n      if (ok) {\n        D(selfSet(self.deleteAll(fields)));\n        D(fundingNotification());\n        Message.success(message);\n        Router.push('/my/account');\n      }\n\n      return ok;\n    })[\"catch\"](function (e) {\n      throw e;\n    });\n  };\n};","map":{"version":3,"sources":["/Users/zhangxuecai/Projects/react-blog/http/self.js"],"names":["_","React","I","Map","message","Message","Router","request","viewSetIn","setFetching","getFetching","setLoggedIn","viewSet","loginState","uploadPhotos","D","S","data","view","get","toList","toJS","id","self","post","then","body","ok","success","signup","info","setToken","s","logout","all","setAuthorization","selfSet","push","processSignupQuery","query","c","email","update","s1","withMutations","s2","setIn","isEmpty","set","form","props","setFieldsValue","mobile","getUser","shortId","short_id","r","createAccessToken","deviceType","for_device_type","tokens","tokensIndex","deleteToken","accessToken","access_token","isUserExist","value","callback","exists","getProjectActives","payments","updateSelf","put","fundingNotification","changePassword","fields","filter","v","k","indexOf","deleteAll","e"],"mappings":"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","sourcesContent":["import _ from 'lodash'\nimport React from 'react'\nimport I, { Map } from 'immutable'\nimport { message as Message } from 'antd'\nimport Router from 'next/router'\nimport request from '../utils/request'\n//import { selfMerge, selfSet } from '../redux/modules/self'\nimport { viewSetIn, setFetching, getFetching, setLoggedIn, viewSet } from '../redux/modules/view'\nimport loginState from './sessions'\n\n\nexport const uploadPhotos = () => (D, S) => {\n  const data = JSON.stringify(S().view.get('imgList').toList().toJS())\n  const id = S().self.get('id')\n\n  request.post('/photos', { data,id })\n    .then(body => {\n      if (body.ok) {\n        D(viewSetIn(['imgList'], {})) // eslint-disable-line no-use-before-define\n        Message.success('保存成功')\n      }\n    })\n}\n\nexport const signup = () => (D, S) => {\n  const { view } = S()\n  return request\n    .post('/users', {\n      data: view.get('signup')\n    })\n    .then(body => {\n      const { ok, message } = body\n      if (ok === false) {\n        Message.info(message)\n      } else {\n        D(loginState())\n      }\n      D(viewSetIn(['signupLoading'], false))\n    })\n}\n\n\nexport const setToken = s => D =>\n  request.setToken(s).then(() => {\n    D(loginState())\n  })\n\nexport const logout = () => D =>\n  Promise.all([request.delete('users/sign_out'), request.setAuthorization('')]).then(() => {\n    D(setLoggedIn({ ok: false }))\n    D(selfSet(Map()))\n    Message.success('已登出')\n    Router.push('/')\n  })\n\nexport const processSignupQuery = query => (D, S) => {\n  const { c, email } = query\n  const { view } = S()\n  D(\n    viewSet(\n      view.update('signup', s1 =>\n        s1.withMutations(s2 => {\n          s2.setIn(['settings', 'area'], 'EC')\n          if (!_.isEmpty(c)) {\n            s2.set('referrer_short_id', c)\n          }\n          if (!_.isEmpty(email)) {\n            const { form } = this.props\n            s2.set('email_or_mobile', email)\n            form.setFieldsValue({\n              email,\n              mobile: email\n            })\n          }\n        })\n      )\n    )\n  )\n}\n\nexport const getUser = shortId => D =>\n  request.get('users/name', { short_id: shortId }).then(r => {\n    const { data } = r\n    D(viewSetIn(['signup', 'settings', 'referrer_name'], data))\n  })\n\nexport const createAccessToken = deviceType => D =>\n  request.post('developers/create_access_token', { for_device_type: deviceType }).then(body => {\n    if (body.ok) {\n      D(viewSetIn(['tokens'], body.tokens))\n    }\n  })\n\nexport const tokensIndex = () => D =>\n  request.get('developers/access_tokens').then(body => {\n    if (body.ok) {\n      D(viewSetIn(['tokens'], body.tokens))\n    }\n  })\n\nexport const deleteToken = accessToken => D =>\n  request.post('developers/remove_access_token', { access_token: accessToken }).then(body => {\n    if (body.ok) {\n      D(viewSetIn(['tokens'], body.tokens))\n    }\n  })\n\nexport const isUserExist = (value, callback) => () =>\n  request\n    .post('users/exists_by_any', {\n      value\n    })\n    .then(r => {\n      const { exists, message } = r\n      if (exists) {\n        callback(message)\n      }\n    })\n\nexport const getProjectActives = id => D => {\n  // todo push 404\n  return request.get('projects/payments_list', { id }).then(body => {\n    const { ok, payments } = body\n    if (ok) {\n      D(viewSetIn(['project', 'actives'], payments))\n    }\n  })\n}\n\n\n\nexport const updateSelf = () => (D, S) => {\n  const { self } = S()\n  request.put(`users/profiles/${self.get('id')}`, self.toJS()).then(body => {\n    if (body.ok) {\n      D(fundingNotification()) // eslint-disable-line no-use-before-define\n      Message.success('保存成功')\n    }\n  })\n}\n\nexport const changePassword = () => (D, S) => {\n  const { self } = S()\n  const fields = ['password', 'oldPassword', 'passwordConfirmation']\n  request\n    .put(`users/passwords`, {\n      data: S().self.filter((v, k) => fields.indexOf(k) !== -1)\n    })\n    .then(body => {\n      const { ok, message } = body\n      if (ok) {\n        D(selfSet(self.deleteAll(fields)))\n        D(fundingNotification())\n        Message.success(message)\n        Router.push('/my/account')\n      }\n      return ok\n    })\n    .catch(e => {\n      throw e\n    })\n}\n\n"]},"metadata":{},"sourceType":"module"}