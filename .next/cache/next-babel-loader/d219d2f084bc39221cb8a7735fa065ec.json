{"ast":null,"code":"import { message } from 'antd';\nimport request from '../utils/request';\nimport { viewSetIn } from '../redux/modules/view';\nconst HttpState = {\n  UNKNOWN: 'UNKNOWN',\n  REQUESTING: 'REQUESTING',\n  REQUESTED: 'REQUESTED'\n};\n\nconst loginState = () => (D, S) => {\n  const {\n    view\n  } = S();\n  const statePath = ['loginState', 'state'];\n\n  if (view.getIn(statePath) !== HttpState.REQUESTING) {\n    D(viewSetIn(statePath, HttpState.REQUESTING));\n    return request.post('users/verifications/refresh_token').then(body => {\n      const {\n        ok,\n        error\n      } = body;\n\n      if (ok === true) {\n        message.info('已登录');\n      }\n\n      if (error !== undefined) {\n        D(viewSetIn(['loginState', 'result', 'ok'], false));\n        request.setAuthorization('');\n      } else {\n        D(viewSetIn(['loginState', 'result', 'ok'], true));\n      }\n    }).finally(() => {\n      D(viewSetIn(statePath, HttpState.REQUESTED));\n    });\n  }\n\n  return false;\n};\n\nexport default loginState;","map":{"version":3,"sources":["/Users/zhangxuecai/Projects/react-blog/http/sessions.js"],"names":["message","request","viewSetIn","HttpState","UNKNOWN","REQUESTING","REQUESTED","loginState","D","S","view","statePath","getIn","post","then","body","ok","error","info","undefined","setAuthorization","finally"],"mappings":"AAAA,SAASA,OAAT,QAAwB,MAAxB;AACA,OAAOC,OAAP,MAAoB,kBAApB;AACA,SAASC,SAAT,QAA0B,uBAA1B;AAEA,MAAMC,SAAS,GAAG;AAChBC,EAAAA,OAAO,EAAE,SADO;AAEhBC,EAAAA,UAAU,EAAE,YAFI;AAGhBC,EAAAA,SAAS,EAAE;AAHK,CAAlB;;AAKA,MAAMC,UAAU,GAAG,MAAM,CAACC,CAAD,EAAIC,CAAJ,KAAU;AACjC,QAAM;AAAEC,IAAAA;AAAF,MAAWD,CAAC,EAAlB;AACA,QAAME,SAAS,GAAG,CAAC,YAAD,EAAe,OAAf,CAAlB;;AACA,MAAID,IAAI,CAACE,KAAL,CAAWD,SAAX,MAA0BR,SAAS,CAACE,UAAxC,EAAoD;AAClDG,IAAAA,CAAC,CAACN,SAAS,CAACS,SAAD,EAAYR,SAAS,CAACE,UAAtB,CAAV,CAAD;AACA,WAAOJ,OAAO,CACXY,IADI,CACC,mCADD,EAEJC,IAFI,CAECC,IAAI,IAAI;AACZ,YAAM;AAAEC,QAAAA,EAAF;AAAMC,QAAAA;AAAN,UAAgBF,IAAtB;;AACA,UAAIC,EAAE,KAAK,IAAX,EAAiB;AACfhB,QAAAA,OAAO,CAACkB,IAAR,CAAa,KAAb;AACD;;AACD,UAAID,KAAK,KAAKE,SAAd,EAAyB;AACvBX,QAAAA,CAAC,CAACN,SAAS,CAAC,CAAC,YAAD,EAAe,QAAf,EAAyB,IAAzB,CAAD,EAAiC,KAAjC,CAAV,CAAD;AACAD,QAAAA,OAAO,CAACmB,gBAAR,CAAyB,EAAzB;AACD,OAHD,MAGO;AACLZ,QAAAA,CAAC,CAACN,SAAS,CAAC,CAAC,YAAD,EAAe,QAAf,EAAyB,IAAzB,CAAD,EAAiC,IAAjC,CAAV,CAAD;AACD;AACF,KAbI,EAcJmB,OAdI,CAcI,MAAM;AACbb,MAAAA,CAAC,CAACN,SAAS,CAACS,SAAD,EAAYR,SAAS,CAACG,SAAtB,CAAV,CAAD;AACD,KAhBI,CAAP;AAiBD;;AACD,SAAO,KAAP;AACD,CAxBD;;AA0BA,eAAeC,UAAf","sourcesContent":["import { message } from 'antd'\nimport request from '../utils/request'\nimport { viewSetIn } from '../redux/modules/view'\n\nconst HttpState = {\n  UNKNOWN: 'UNKNOWN',\n  REQUESTING: 'REQUESTING',\n  REQUESTED: 'REQUESTED'\n}\nconst loginState = () => (D, S) => {\n  const { view } = S()\n  const statePath = ['loginState', 'state']\n  if (view.getIn(statePath) !== HttpState.REQUESTING) {\n    D(viewSetIn(statePath, HttpState.REQUESTING))\n    return request\n      .post('users/verifications/refresh_token')\n      .then(body => {\n        const { ok, error } = body\n        if (ok === true) {\n          message.info('已登录')\n        }\n        if (error !== undefined) {\n          D(viewSetIn(['loginState', 'result', 'ok'], false))\n          request.setAuthorization('')\n        } else {\n          D(viewSetIn(['loginState', 'result', 'ok'], true))\n        }\n      })\n      .finally(() => {\n        D(viewSetIn(statePath, HttpState.REQUESTED))\n      })\n  }\n  return false\n}\n\nexport default loginState\n"]},"metadata":{},"sourceType":"module"}