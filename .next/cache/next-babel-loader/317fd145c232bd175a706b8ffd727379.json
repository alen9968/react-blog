{"ast":null,"code":"import { message } from 'antd';\nimport request from '../utils/request';\nimport { viewSetIn } from '../redux/modules/view';\nvar HttpState = {\n  UNKNOWN: 'UNKNOWN',\n  REQUESTING: 'REQUESTING',\n  REQUESTED: 'REQUESTED'\n};\n\nvar loginState = function loginState() {\n  return function (D, S) {\n    var _S = S(),\n        view = _S.view;\n\n    var statePath = ['loginState', 'state'];\n\n    if (view.getIn(statePath) !== HttpState.REQUESTING) {\n      D(viewSetIn(statePath, HttpState.REQUESTING));\n      return request.post('users/verifications/refresh_token').then(function (body) {\n        var ok = body.ok,\n            error = body.error;\n\n        if (ok === true) {\n          message.info('已登录');\n        }\n\n        if (error !== undefined) {\n          D(viewSetIn(['loginState', 'result', 'ok'], false));\n          request.setAuthorization('');\n        } else {\n          D(viewSetIn(['loginState', 'result', 'ok'], true));\n        }\n      })[\"finally\"](function () {\n        D(viewSetIn(statePath, HttpState.REQUESTED));\n      });\n    }\n\n    return false;\n  };\n};\n\nexport default loginState;","map":{"version":3,"sources":["/Users/zhangxuecai/Projects/react-blog/http/sessions.js"],"names":["message","request","viewSetIn","HttpState","UNKNOWN","REQUESTING","REQUESTED","loginState","D","S","view","statePath","getIn","post","then","body","ok","error","info","undefined","setAuthorization"],"mappings":"AAAA,SAASA,OAAT,QAAwB,MAAxB;AACA,OAAOC,OAAP,MAAoB,kBAApB;AACA,SAASC,SAAT,QAA0B,uBAA1B;AAEA,IAAMC,SAAS,GAAG;AAChBC,EAAAA,OAAO,EAAE,SADO;AAEhBC,EAAAA,UAAU,EAAE,YAFI;AAGhBC,EAAAA,SAAS,EAAE;AAHK,CAAlB;;AAKA,IAAMC,UAAU,GAAG,SAAbA,UAAa;AAAA,SAAM,UAACC,CAAD,EAAIC,CAAJ,EAAU;AAAA,aAChBA,CAAC,EADe;AAAA,QACzBC,IADyB,MACzBA,IADyB;;AAEjC,QAAMC,SAAS,GAAG,CAAC,YAAD,EAAe,OAAf,CAAlB;;AACA,QAAID,IAAI,CAACE,KAAL,CAAWD,SAAX,MAA0BR,SAAS,CAACE,UAAxC,EAAoD;AAClDG,MAAAA,CAAC,CAACN,SAAS,CAACS,SAAD,EAAYR,SAAS,CAACE,UAAtB,CAAV,CAAD;AACA,aAAOJ,OAAO,CACXY,IADI,CACC,mCADD,EAEJC,IAFI,CAEC,UAAAC,IAAI,EAAI;AAAA,YACJC,EADI,GACUD,IADV,CACJC,EADI;AAAA,YACAC,KADA,GACUF,IADV,CACAE,KADA;;AAEZ,YAAID,EAAE,KAAK,IAAX,EAAiB;AACfhB,UAAAA,OAAO,CAACkB,IAAR,CAAa,KAAb;AACD;;AACD,YAAID,KAAK,KAAKE,SAAd,EAAyB;AACvBX,UAAAA,CAAC,CAACN,SAAS,CAAC,CAAC,YAAD,EAAe,QAAf,EAAyB,IAAzB,CAAD,EAAiC,KAAjC,CAAV,CAAD;AACAD,UAAAA,OAAO,CAACmB,gBAAR,CAAyB,EAAzB;AACD,SAHD,MAGO;AACLZ,UAAAA,CAAC,CAACN,SAAS,CAAC,CAAC,YAAD,EAAe,QAAf,EAAyB,IAAzB,CAAD,EAAiC,IAAjC,CAAV,CAAD;AACD;AACF,OAbI,aAcI,YAAM;AACbM,QAAAA,CAAC,CAACN,SAAS,CAACS,SAAD,EAAYR,SAAS,CAACG,SAAtB,CAAV,CAAD;AACD,OAhBI,CAAP;AAiBD;;AACD,WAAO,KAAP;AACD,GAxBkB;AAAA,CAAnB;;AA0BA,eAAeC,UAAf","sourcesContent":["import { message } from 'antd'\nimport request from '../utils/request'\nimport { viewSetIn } from '../redux/modules/view'\n\nconst HttpState = {\n  UNKNOWN: 'UNKNOWN',\n  REQUESTING: 'REQUESTING',\n  REQUESTED: 'REQUESTED'\n}\nconst loginState = () => (D, S) => {\n  const { view } = S()\n  const statePath = ['loginState', 'state']\n  if (view.getIn(statePath) !== HttpState.REQUESTING) {\n    D(viewSetIn(statePath, HttpState.REQUESTING))\n    return request\n      .post('users/verifications/refresh_token')\n      .then(body => {\n        const { ok, error } = body\n        if (ok === true) {\n          message.info('已登录')\n        }\n        if (error !== undefined) {\n          D(viewSetIn(['loginState', 'result', 'ok'], false))\n          request.setAuthorization('')\n        } else {\n          D(viewSetIn(['loginState', 'result', 'ok'], true))\n        }\n      })\n      .finally(() => {\n        D(viewSetIn(statePath, HttpState.REQUESTED))\n      })\n  }\n  return false\n}\n\nexport default loginState\n"]},"metadata":{},"sourceType":"module"}